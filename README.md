# Multi-agent system learning to predict user behavior

This project is a bachelor's thesis and consists of a multi-agent system, smart home simulation and experiments with nerual networks for predicting user interactions in a smart home environment. 

## Project Structure

- **ModelTraining/**: Contains PyTorch and PyTorch Lightning experiments for training prediction models
- **MAS-Simulation/**: Contains the simulation environment and multi-agent system
  - **MAS/**: Multi-agent system implementation using SPADE
  - **Simulation/**: Smart home simulation using SimPy


## Requirements

This project requires Python 3.12+ and several dependencies listed in the requirements.txt file.

## Installation

1. Create and activate a virtual environment (recommended):
```bash
python -m venv venv
# Windows
venv\Scripts\activate
# Linux/macOS
source venv/bin/activate
```

2. Install the required dependencies:
```bash
pip install -r requirements.txt
```

## XMPP Server Setup (Required for Multi-Agent System)

The multi-agent system requires an XMPP server for agent communication. Follow these steps to set up ejabberd 24.02 using Docker:

1. Install Docker on your system:
   - [Docker Desktop for Windows](https://www.docker.com/products/docker-desktop)
   - [Docker for Linux](https://docs.docker.com/engine/install/)
   - [Docker Desktop for Mac](https://www.docker.com/products/docker-desktop)

2. Pull the ejabberd Docker image:
```bash
docker pull ejabberd/ecs:24.02
```
3. Create a directory for ejabberd configuration:
```bash
mkdir -p ejabberd/conf
```
4. Copy the ejabberd.yml configuration file to the conf directory:
```bash
cp MAS-Simulation/ejabberd.yml ejabberd/conf/
```
5. Run the ejabberd container:
```bash
docker run -d --name ejabberd \
  -p 5222:5222 -p 5269:5269 -p 5280:5280 -p 5443:5443 -p 1883:1883 \
  -v $(pwd)/ejabberd/conf:/opt/ejabberd/conf \
  ejabberd/ecs:24.02
```
6. Register a new admin user (replace 'password' with your desired password):
```bash
docker exec -it ejabberd bin/ejabberdctl register admin localhost password
```
7. Verify the server is running:
```bash
docker exec -it ejabberd bin/ejabberdctl status
```
Note: The MAS-Simulation/config.yaml file is already configured to use 'localhost' as the XMPP server. If you run the XMPP server on a different host, update the jabber_host setting accordingly.

## Running the Project Components

### Simulation

Run the smart home simulation without MAS:

```bash
cd MAS-Simulation
python Simulation.py -c config.yaml
```

The simulation settings can be found in the MAS-Simulation/config.yaml file under the Simulation section.

### Model Training

To train the neural network models:

```bash
cd ModelTraining
python Lightning.py -m <model_name> -c config.yaml
```

Where `<model_name>` is one of the available models: CfC, LSTM, RNN, or FC.

Additional optional arguments:
- `-v/--version`: Version name for experiment logging
- `--batch_size`: Override batch size
- `--hidden_size`: Override hidden size
- `--num_layers`: Override number of layers
- `--learning_rate`: Override learning rate
- `--max_epochs`: Override max epochs
- `--sequence_len`: Override sequence length

The training uses the datasets specified in the configuration file. These datasets can be generated by running the simulation described above. The default configuration file (config.yaml) contains dataset paths and training parameters.

Training results can be viewed in TensorBoard:

```bash
cd ModelTraining
python -m tensorboard.main --logdir logs\tb --bind_all
```

Once TensorBoard is running, open TensorBoard in a web browser (the url should be displayed when running the command).

### Multi-Agent System Interface Demo

Before running the multi-agent system make sure you the ejabberd XMPP server is running using the MAS-Simulation/ejabberd.yaml configuration.  
To run the multi-agent system interface demonstration:

```bash
cd MAS-Simulation/MAS
python InterfaceTest.py
```

The interface demonstration shows hands on how the system can be used.

### Simulation with Multi-Agent System

Before running the multi-agent system make sure you the ejabberd XMPP server is running using the MAS-Simulation/ejabberd.yaml configuration.  
To run the simulation with the intergrated multi-agent system:

```bash
cd MAS-Simulation
python SimulationMAS.py -c config.yaml
```

This will start both the multi-agent system and the simulation environment, enabling their interaction.


